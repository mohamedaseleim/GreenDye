<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /
  
  # Don't rewrite files or directories
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  
  # Don't rewrite API requests
  RewriteCond %{REQUEST_URI} !^/api/
  
  # Don't rewrite static files
  RewriteCond %{REQUEST_URI} !^/uploads/
  RewriteCond %{REQUEST_URI} !^/invoices/
  
  # Don't rewrite static asset files
  RewriteCond %{REQUEST_URI} !^/static/
  
  # Rewrite everything else to index.html to allow client-side routing
  RewriteRule ^ /index.html [L,QSA]
</IfModule>

# Enable error document for 404 to serve index.html
<IfModule mod_negotiation.c>
  Options -MultiViews
</IfModule>

# Fallback for servers without mod_rewrite
ErrorDocument 404 /index.html

# Set default index
DirectoryIndex index.html

# Disable directory browsing
Options -Indexes

# Set proper MIME types
<IfModule mod_mime.c>
  AddType application/javascript js mjs
  AddType application/json json map
  AddType image/svg+xml svg svgz
</IfModule>

# Enable compression if available
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>
